# render.yaml
services:
  # ────────────── Web API ──────────────
  - type: web
    name: tiktok-trend-api
    env: node
    plan: free
    # Install deps ➜ download Chrome ➜ continue
    buildCommand: |
      npm install
      npx puppeteer browsers install chrome
    startCommand: "node index.js"
    envVars:
      - key: DATABASE_URL         # wired automatically from the DB below
        fromDatabase:
          name: tiktok-db
          property: connectionString
      - key: COOKIE               # optional TikTok session cookie
        value: ""

  # ────────────── Scheduled scraper ──────────────
  - type: cron                    # cron needs Starter or higher
    name: tiktok-trend-cron
    env: node
    plan: starter
    buildCommand: |
      npm install
      npx puppeteer browsers install chrome
    startCommand: "node cron.js"
    schedule: "0 */3 * * *"       # every 3 hours
    envVars:
      - key: DATABASE_URL
        fromDatabase:
          name: tiktok-db
          property: connectionString
      - key: KEYWORDS
        value: "summer outfits,cleaning hacks,bible study"
      - key: COOKIE
        value: ""

# ────────────── Postgres database ──────────────
databases:
  - name: tiktok-db
    plan: free
